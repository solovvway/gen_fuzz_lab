from scapy.all import *
import time

pkts = rdpcap('from_curl.pcap')
# test = IP(dst='192.168.0.14',src='192.168.0.13')/TCP()/Raw("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA")

# send(test,iface='veth0')

# test = IP(dst='192.168.0.14',src='192.168.0.13')/TCP()
# print(test.time, time.time())
# send(test,iface='veth0')

# for i in pkts:
#     if TCP in i:
#         # i[IP].src = '192.168.0.13'
#         if i[IP].dst == '192.168.0.14':
#         # i /= Raw("dfasdfsdfsdf")
#             i.time = time.time()
#             print(i.command())

#             send(i,iface='veth0')
#     else:
#         print("Пакет не содержит заголовок IP:", i.summary())

def my_send(rd, count=100):
    pkt_cnt = 0
    p_out = []

    for p in rd:
        pkt_cnt += 1
        np = p.payload
        np[IP].dst = '192.168.0.14'
        np[IP].src = '192.168.0.13'
        del np[IP].chksum
        p_out.append(np)
        if pkt_cnt % count == 0:
            send(PacketList(p_out))
            p_out = []

    # Send remaining in final batch
    send(PacketList(p_out))
    # print("Total packets sent %d" % pkt_cn)

my_send(pkts)